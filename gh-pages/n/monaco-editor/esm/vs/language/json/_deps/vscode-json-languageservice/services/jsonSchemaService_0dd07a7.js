define("829557b",function(e,t){"use strict";function r(e){try{var t=s.default.parse(e);if("file"===t.scheme)return t.fsPath}catch(r){}return e}Object.defineProperty(t,"__esModule",{value:!0});var n=e("849c8c1"),i=n.__importStar(e("c2fdf10")),s=n.__importDefault(e("be0eefb")),o=n.__importStar(e("1d1e390")),a=n.__importStar(e("c4fc87e")),c=n.__importStar(e("a22b28e")),h=c.loadMessageBundle(),u=function(){function e(e){try{this.patternRegExp=new RegExp(o.convertSimple2RegExpPattern(e)+"$")}catch(t){this.patternRegExp=null}this.schemas=[]}return e.prototype.addSchema=function(e){this.schemas.push(e)},e.prototype.matchesPattern=function(e){return this.patternRegExp&&this.patternRegExp.test(e)},e.prototype.getSchemas=function(){return this.schemas},e}(),l=function(){function e(e,t,r){this.service=e,this.url=t,this.dependencies={},r&&(this.unresolvedSchema=this.service.promise.resolve(new f(r)))}return e.prototype.getUnresolvedSchema=function(){return this.unresolvedSchema||(this.unresolvedSchema=this.service.loadSchema(this.url)),this.unresolvedSchema},e.prototype.getResolvedSchema=function(){var e=this;return this.resolvedSchema||(this.resolvedSchema=this.getUnresolvedSchema().then(function(t){return e.service.resolveSchemaContent(t,e.url,e.dependencies)})),this.resolvedSchema},e.prototype.clearSchema=function(){this.resolvedSchema=null,this.unresolvedSchema=null,this.dependencies={}},e}(),f=function(){function e(e,t){void 0===t&&(t=[]),this.schema=e,this.errors=t}return e}();t.UnresolvedSchema=f;var d=function(){function e(e,t){void 0===t&&(t=[]),this.schema=e,this.errors=t}return e.prototype.getSection=function(e){return a.asSchema(this.getSectionRecursive(e,this.schema))},e.prototype.getSectionRecursive=function(e,t){if(!t||"boolean"==typeof t||0===e.length)return t;var r=e.shift();if(t.properties)return this.getSectionRecursive(e,t.properties[r]);if(t.patternProperties)for(var n=0,i=Object.keys(t.patternProperties);n<i.length;n++){var s=i[n],o=new RegExp(s);if(o.test(r))return this.getSectionRecursive(e,t.patternProperties[s])}else{if("object"==typeof t.additionalProperties)return this.getSectionRecursive(e,t.additionalProperties);if(r.match("[0-9]+"))if(Array.isArray(t.items)){var a=parseInt(r,10);if(!isNaN(a)&&t.items[a])return this.getSectionRecursive(e,t.items[a])}else if(t.items)return this.getSectionRecursive(e,t.items)}return null},e}();t.ResolvedSchema=d;var m=function(){function e(e,t,r){this.contextService=t,this.requestService=e,this.promiseConstructor=r||Promise,this.callOnDispose=[],this.contributionSchemas={},this.contributionAssociations={},this.schemasById={},this.filePatternAssociations=[],this.filePatternAssociationById={},this.registeredSchemasIds={}}return e.prototype.getRegisteredSchemaIds=function(e){return Object.keys(this.registeredSchemasIds).filter(function(t){var r=s.default.parse(t).scheme;return"schemaservice"!==r&&(!e||e(r))})},Object.defineProperty(e.prototype,"promise",{get:function(){return this.promiseConstructor},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(;this.callOnDispose.length>0;)this.callOnDispose.pop()()},e.prototype.onResourceChange=function(e){var t=this,r=!1;e=this.normalizeId(e);for(var n=[e],i=Object.keys(this.schemasById).map(function(e){return t.schemasById[e]});n.length;)for(var s=n.pop(),o=0;o<i.length;o++){var a=i[o];a&&(a.url===s||a.dependencies[s])&&(a.url!==s&&n.push(a.url),a.clearSchema(),i[o]=void 0,r=!0)}return r},e.prototype.normalizeId=function(e){return s.default.parse(e).toString()},e.prototype.setSchemaContributions=function(e){if(e.schemas){var t=e.schemas;for(var r in t){var n=this.normalizeId(r);this.contributionSchemas[n]=this.addSchemaHandle(n,t[r])}}if(e.schemaAssociations){var i=e.schemaAssociations;for(var s in i){var o=i[s];this.contributionAssociations[s]=o;for(var a=this.getOrAddFilePatternAssociation(s),c=0,h=o;c<h.length;c++){var u=h[c],r=this.normalizeId(u);a.addSchema(r)}}}},e.prototype.addSchemaHandle=function(e,t){var r=new l(this,e,t);return this.schemasById[e]=r,r},e.prototype.getOrAddSchemaHandle=function(e,t){return this.schemasById[e]||this.addSchemaHandle(e,t)},e.prototype.getOrAddFilePatternAssociation=function(e){var t=this.filePatternAssociationById[e];return t||(t=new u(e),this.filePatternAssociationById[e]=t,this.filePatternAssociations.push(t)),t},e.prototype.registerExternalSchema=function(e,t,r){void 0===t&&(t=null);var n=this.normalizeId(e);if(this.registeredSchemasIds[n]=!0,t)for(var i=0,s=t;i<s.length;i++){var o=s[i];this.getOrAddFilePatternAssociation(o).addSchema(n)}return r?this.addSchemaHandle(n,r):this.getOrAddSchemaHandle(n)},e.prototype.clearExternalSchemas=function(){this.schemasById={},this.filePatternAssociations=[],this.filePatternAssociationById={},this.registeredSchemasIds={};for(var e in this.contributionSchemas)this.schemasById[e]=this.contributionSchemas[e],this.registeredSchemasIds[e]=!0;for(var t in this.contributionAssociations)for(var r=this.getOrAddFilePatternAssociation(t),n=0,i=this.contributionAssociations[t];n<i.length;n++){var s=i[n],e=this.normalizeId(s);r.addSchema(e)}},e.prototype.getResolvedSchema=function(e){var t=this.normalizeId(e),r=this.schemasById[t];return r?r.getResolvedSchema():this.promise.resolve(null)},e.prototype.loadSchema=function(e){if(!this.requestService){var t=h("json.schema.norequestservice","Unable to load schema from '{0}'. No schema request service available",r(e));return this.promise.resolve(new f({},[t]))}return this.requestService(e).then(function(t){if(!t){var n=h("json.schema.nocontent","Unable to load schema from '{0}': No content.",r(e));return new f({},[n])}var s={},o=[];s=i.parse(t,o);var a=o.length?[h("json.schema.invalidFormat","Unable to parse content from '{0}': Parse error at offset {1}.",r(e),o[0].offset)]:[];return new f(s,a)},function(e){var t=e.toString(),r=e.toString().split("Error: ");return r.length>1&&(t=r[1]),new f({},[t])})},e.prototype.resolveSchemaContent=function(e,t,r){var n=this,i=e.errors.slice(0),s=e.schema,o=this.contextService,a=function(e,t){if(!t)return e;var r=e;return"/"===t[0]&&(t=t.substr(1)),t.split("/").some(function(e){return r=r[e],!r}),r},c=function(e,t,r,n){var s=a(t,n);if(s)for(var o in s)s.hasOwnProperty(o)&&!e.hasOwnProperty(o)&&(e[o]=s[o]);else i.push(h("json.schema.invalidref","$ref '{0}' in '{1}' can not be resolved.",n,r))},u=function(e,t,r,s,a){o&&!/^\w+:\/\/.*/.test(t)&&(t=o.resolveRelativePath(t,s)),t=n.normalizeId(t);var u=n.getOrAddSchemaHandle(t);return u.getUnresolvedSchema().then(function(n){if(a[t]=!0,n.errors.length){var s=r?t+"#"+r:t;i.push(h("json.schema.problemloadingref","Problems loading reference '{0}': {1}",s,n.errors[0]))}return c(e,n.schema,t,r),l(e,n.schema,t,u.dependencies)})},l=function(e,t,r,i){if(!e||"object"!=typeof e)return Promise.resolve(null);for(var s=[e],o=[],a=[],h=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];"object"==typeof i&&s.push(i)}},l=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];if("object"==typeof i)for(var o in i){var a=i[o];"object"==typeof a&&s.push(a)}}},f=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(Array.isArray(i))for(var o=0,a=i;o<a.length;o++){var c=a[o];"object"==typeof c&&s.push(c)}}},d=function(e){for(var n=[];e.$ref;){var s=e.$ref,o=s.split("#",2);if(delete e.$ref,o[0].length>0)return void a.push(u(e,o[0],o[1],r,i));-1===n.indexOf(s)&&(c(e,t,r,o[1]),n.push(s))}h(e.items,e.additionalProperties,e.not,e.contains,e.propertyNames,e.if,e.then,e.else),l(e.definitions,e.properties,e.patternProperties,e.dependencies),f(e.anyOf,e.allOf,e.oneOf,e.items)};s.length;){var m=s.pop();o.indexOf(m)>=0||(o.push(m),d(m))}return n.promise.all(a)};return l(s,s,t,r).then(function(){return new d(s,i)})},e.prototype.getSchemaForResource=function(e,t){if(t&&t.root&&"object"===t.root.type){var r=t.root.properties.filter(function(e){return"$schema"===e.keyNode.value&&e.valueNode&&"string"===e.valueNode.type});if(r.length>0){var n=a.getNodeValue(r[0].valueNode);if(n&&o.startsWith(n,".")&&this.contextService&&(n=this.contextService.resolveRelativePath(n,e)),n){var i=this.normalizeId(n);return this.getOrAddSchemaHandle(i).getResolvedSchema()}}}for(var s=Object.create(null),c=[],h=0,u=this.filePatternAssociations;h<u.length;h++){var l=u[h];if(l.matchesPattern(e))for(var f=0,d=l.getSchemas();f<d.length;f++){var m=d[f];s[m]||(c.push(m),s[m]=!0)}}return c.length>0?this.createCombinedSchema(e,c).getResolvedSchema():this.promise.resolve(null)},e.prototype.createCombinedSchema=function(e,t){if(1===t.length)return this.getOrAddSchemaHandle(t[0]);var r="schemaservice://combinedSchema/"+encodeURIComponent(e),n={allOf:t.map(function(e){return{$ref:e}})};return this.addSchemaHandle(r,n)},e}();t.JSONSchemaService=m});