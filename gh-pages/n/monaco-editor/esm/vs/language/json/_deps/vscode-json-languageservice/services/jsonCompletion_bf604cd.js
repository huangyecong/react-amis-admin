define("2b1fcae",function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("849c8c1"),n=r.__importStar(e("c4fc87e")),o=r.__importStar(e("c2fdf10")),i=e("d3f7126"),a=e("1d1e390"),s=e("020e2f7"),l=e("4872c6c"),u=r.__importStar(e("a22b28e")),p=u.loadMessageBundle(),c=function(){function e(e,t,r,n){void 0===t&&(t=[]),void 0===r&&(r=Promise),void 0===n&&(n={}),this.schemaService=e,this.contributions=t,this.promiseConstructor=r,this.clientCapabilities=n,this.templateVarIdCounter=0}return e.prototype.doResolve=function(e){for(var t=this.contributions.length-1;t>=0;t--)if(this.contributions[t].resolveCompletion){var r=this.contributions[t].resolveCompletion(e);if(r)return r}return this.promiseConstructor.resolve(e)},e.prototype.doComplete=function(e,t,r){var o=this,i={items:[],isIncomplete:!1},a=e.offsetAt(t),s=r.getNodeFromOffset(a,!0);if(this.isInComment(e,s?s.offset:0,a))return Promise.resolve(i);var u=this.getCurrentWord(e,a),p=null;if(!s||"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"null"!==s.type){var c=a-u.length;c>0&&'"'===e.getText()[c-1]&&c--,p=l.Range.create(e.positionAt(c),t)}else p=l.Range.create(e.positionAt(s.offset),e.positionAt(s.offset+s.length));var d={},f={add:function(e){var t=d[e.label];t?t.documentation||(t.documentation=e.documentation):(d[e.label]=e,p&&(e.textEdit=l.TextEdit.replace(p,e.insertText)),i.items.push(e))},setAsIncomplete:function(){i.isIncomplete=!0},error:function(e){console.error(e)},log:function(e){console.log(e)},getNumberOfProposals:function(){return i.items.length}};return this.schemaService.getSchemaForResource(e.uri,r).then(function(t){var c=[],m=!0,g="",y=null;if(s&&"string"===s.type){var h=s.parent;h&&"property"===h.type&&h.keyNode===s&&(m=!h.valueNode,y=h,g=e.getText().substr(s.offset+1,s.length-2),h&&(s=h.parent))}if(s&&"object"===s.type){if(s.offset===a)return i;var x=s.properties;x.forEach(function(e){y&&y===e||(d[e.keyNode.value]=l.CompletionItem.create("__"))});var T="";m&&(T=o.evaluateSeparatorAfter(e,e.offsetAt(p.end))),t?o.getPropertyCompletions(t,r,s,m,T,f):o.getSchemaLessPropertyCompletions(r,s,g,f);var v=n.getNodePath(s);o.contributions.forEach(function(t){var r=t.collectPropertyCompletions(e.uri,v,u,m,""===T,f);r&&c.push(r)}),!t&&u.length>0&&'"'!==e.getText().charAt(a-u.length-1)&&(f.add({kind:l.CompletionItemKind.Property,label:o.getLabelForValue(u),insertText:o.getInsertTextForProperty(u,null,!1,T),insertTextFormat:l.InsertTextFormat.Snippet,documentation:""}),f.setAsIncomplete())}var b={};return t?o.getValueCompletions(t,r,s,a,e,f,b):o.getSchemaLessValueCompletions(r,s,a,e,f),o.contributions.length>0&&o.getContributedValueCompletions(r,s,a,e,f,c),o.promiseConstructor.all(c).then(function(){if(0===f.getNumberOfProposals()){var t=a;!s||"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"null"!==s.type||(t=s.offset+s.length);var r=o.evaluateSeparatorAfter(e,t);o.addFillerValueCompletions(b,r,f)}return i})})},e.prototype.getPropertyCompletions=function(e,t,r,n,o,i){var s=this,u=t.getMatchingSchemas(e.schema,r.offset);u.forEach(function(e){if(e.node===r&&!e.inverted){var t=e.schema.properties;t&&Object.keys(t).forEach(function(e){var r=t[e];if("object"==typeof r&&!r.deprecationMessage&&!r.doNotSuggest){var u={kind:l.CompletionItemKind.Property,label:s.sanitizeLabel(e),insertText:s.getInsertTextForProperty(e,r,n,o),insertTextFormat:l.InsertTextFormat.Snippet,filterText:s.getFilterTextForValue(e),documentation:s.fromMarkup(r.markdownDescription)||r.description||""};a.endsWith(u.insertText,"$1"+o)&&(u.command={title:"Suggest",command:"editor.action.triggerSuggest"}),i.add(u)}})}})},e.prototype.getSchemaLessPropertyCompletions=function(e,t,r,n){var o=this,i=function(e){e.properties.forEach(function(e){var t=e.keyNode.value;n.add({kind:l.CompletionItemKind.Property,label:o.sanitizeLabel(t),insertText:o.getInsertTextForValue(t,""),insertTextFormat:l.InsertTextFormat.Snippet,filterText:o.getFilterTextForValue(t),documentation:""})})};if(t.parent)if("property"===t.parent.type){var a=t.parent.keyNode.value;e.visit(function(e){return"property"===e.type&&e!==t.parent&&e.keyNode.value===a&&e.valueNode&&"object"===e.valueNode.type&&i(e.valueNode),!0})}else"array"===t.parent.type&&t.parent.items.forEach(function(e){"object"===e.type&&e!==t&&i(e)});else"object"===t.type&&n.add({kind:l.CompletionItemKind.Property,label:"$schema",insertText:this.getInsertTextForProperty("$schema",null,!0,""),insertTextFormat:l.InsertTextFormat.Snippet,documentation:"",filterText:this.getFilterTextForValue("$schema")})},e.prototype.getSchemaLessValueCompletions=function(e,t,r,o,i){var a=this,s=r;if(!t||"string"!==t.type&&"number"!==t.type&&"boolean"!==t.type&&"null"!==t.type||(s=t.offset+t.length,t=t.parent),!t)return i.add({kind:this.getSuggestionKind("object"),label:"Empty object",insertText:this.getInsertTextForValue({},""),insertTextFormat:l.InsertTextFormat.Snippet,documentation:""}),void i.add({kind:this.getSuggestionKind("array"),label:"Empty array",insertText:this.getInsertTextForValue([],""),insertTextFormat:l.InsertTextFormat.Snippet,documentation:""});var u=this.evaluateSeparatorAfter(o,s),p=function(e){n.contains(e.parent,r,!0)||i.add({kind:a.getSuggestionKind(e.type),label:a.getLabelTextForMatchingNode(e,o),insertText:a.getInsertTextForMatchingNode(e,o,u),insertTextFormat:l.InsertTextFormat.Snippet,documentation:""}),"boolean"===e.type&&a.addBooleanValueCompletion(!e.value,u,i)};if("property"===t.type&&r>t.colonOffset){var c=t.valueNode;if(c&&(r>c.offset+c.length||"object"===c.type||"array"===c.type))return;var d=t.keyNode.value;e.visit(function(e){return"property"===e.type&&e.keyNode.value===d&&e.valueNode&&p(e.valueNode),!0}),"$schema"===d&&t.parent&&!t.parent.parent&&this.addDollarSchemaCompletions(u,i)}if("array"===t.type)if(t.parent&&"property"===t.parent.type){var f=t.parent.keyNode.value;e.visit(function(e){return"property"===e.type&&e.keyNode.value===f&&e.valueNode&&"array"===e.valueNode.type&&e.valueNode.items.forEach(p),!0})}else t.items.forEach(p)},e.prototype.getValueCompletions=function(e,t,r,n,o,i,a){var s=this,l=n,u=null,p=null;if(!r||"string"!==r.type&&"number"!==r.type&&"boolean"!==r.type&&"null"!==r.type||(l=r.offset+r.length,p=r,r=r.parent),!r)return void this.addSchemaValueCompletions(e.schema,"",i,a);if("property"===r.type&&n>r.colonOffset){var c=r.valueNode;if(c&&n>c.offset+c.length)return;u=r.keyNode.value,r=r.parent}if(r&&(null!==u||"array"===r.type)){var d=this.evaluateSeparatorAfter(o,l),f=t.getMatchingSchemas(e.schema,r.offset,p);f.forEach(function(e){if(e.node===r&&!e.inverted&&e.schema){if("array"===r.type&&e.schema.items)if(Array.isArray(e.schema.items)){var t=s.findItemAtOffset(r,o,n);t<e.schema.items.length&&s.addSchemaValueCompletions(e.schema.items[t],d,i,a)}else s.addSchemaValueCompletions(e.schema.items,d,i,a);if(e.schema.properties){var l=e.schema.properties[u];l&&s.addSchemaValueCompletions(l,d,i,a)}}}),"$schema"!==u||r.parent||this.addDollarSchemaCompletions(d,i),a["boolean"]&&(this.addBooleanValueCompletion(!0,d,i),this.addBooleanValueCompletion(!1,d,i)),a["null"]&&this.addNullValueCompletion(d,i)}},e.prototype.getContributedValueCompletions=function(e,t,r,o,i,a){if(t){if(("string"===t.type||"number"===t.type||"boolean"===t.type||"null"===t.type)&&(t=t.parent),"property"===t.type&&r>t.colonOffset){var s=t.keyNode.value,l=t.valueNode;if(!l||r<=l.offset+l.length){var u=n.getNodePath(t.parent);this.contributions.forEach(function(e){var t=e.collectValueCompletions(o.uri,u,s,i);t&&a.push(t)})}}}else this.contributions.forEach(function(e){var t=e.collectDefaultCompletions(o.uri,i);t&&a.push(t)})},e.prototype.addSchemaValueCompletions=function(e,t,r,n){var o=this;"object"==typeof e&&(this.addEnumValueCompletions(e,t,r),this.addDefaultValueCompletions(e,t,r),this.collectTypes(e,n),Array.isArray(e.allOf)&&e.allOf.forEach(function(e){return o.addSchemaValueCompletions(e,t,r,n)}),Array.isArray(e.anyOf)&&e.anyOf.forEach(function(e){return o.addSchemaValueCompletions(e,t,r,n)}),Array.isArray(e.oneOf)&&e.oneOf.forEach(function(e){return o.addSchemaValueCompletions(e,t,r,n)}))},e.prototype.addDefaultValueCompletions=function(e,t,r,n){var o=this;void 0===n&&(n=0);var i=!1;if(s.isDefined(e.default)){for(var a=e.type,u=e.default,c=n;c>0;c--)u=[u],a="array";r.add({kind:this.getSuggestionKind(a),label:this.getLabelForValue(u),insertText:this.getInsertTextForValue(u,t),insertTextFormat:l.InsertTextFormat.Snippet,detail:p("json.suggest.default","Default value")}),i=!0}Array.isArray(e.examples)&&e.examples.forEach(function(a){for(var s=e.type,u=a,p=n;p>0;p--)u=[u],s="array";r.add({kind:o.getSuggestionKind(s),label:o.getLabelForValue(u),insertText:o.getInsertTextForValue(u,t),insertTextFormat:l.InsertTextFormat.Snippet}),i=!0}),Array.isArray(e.defaultSnippets)&&e.defaultSnippets.forEach(function(a){var u,p,c=e.type,d=a.body,f=a.label;if(s.isDefined(d)){for(var m=e.type,g=n;g>0;g--)d=[d],m="array";u=o.getInsertTextForSnippetValue(d,t),p=o.getFilterTextForSnippetValue(d),f=f||o.getLabelForSnippetValue(d)}else if("string"==typeof a.bodyText){for(var y="",h="",x="",g=n;g>0;g--)y=y+x+"[\n",h=h+"\n"+x+"]",x+="	",c="array";u=y+x+a.bodyText.split("\n").join("\n"+x)+h+t,f=f||o.sanitizeLabel(u),p=u.replace(/[\n]/g,"")}r.add({kind:o.getSuggestionKind(c),label:f,documentation:o.fromMarkup(a.markdownDescription)||a.description,insertText:u,insertTextFormat:l.InsertTextFormat.Snippet,filterText:p}),i=!0}),i||"object"!=typeof e.items||Array.isArray(e.items)||this.addDefaultValueCompletions(e.items,t,r,n+1)},e.prototype.addEnumValueCompletions=function(e,t,r){if(s.isDefined(e.const)&&r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(e.const),insertText:this.getInsertTextForValue(e.const,t),insertTextFormat:l.InsertTextFormat.Snippet,documentation:this.fromMarkup(e.markdownDescription)||e.description}),Array.isArray(e.enum))for(var n=0,o=e.enum.length;o>n;n++){var i=e.enum[n],a=this.fromMarkup(e.markdownDescription)||e.description;e.markdownEnumDescriptions&&n<e.markdownEnumDescriptions.length&&this.doesSupportMarkdown()?a=this.fromMarkup(e.markdownEnumDescriptions[n]):e.enumDescriptions&&n<e.enumDescriptions.length&&(a=e.enumDescriptions[n]),r.add({kind:this.getSuggestionKind(e.type),label:this.getLabelForValue(i),insertText:this.getInsertTextForValue(i,t),insertTextFormat:l.InsertTextFormat.Snippet,documentation:a})}},e.prototype.collectTypes=function(e,t){if(!Array.isArray(e.enum)&&!s.isDefined(e.const)){var r=e.type;Array.isArray(r)?r.forEach(function(e){return t[e]=!0}):t[r]=!0}},e.prototype.addFillerValueCompletions=function(e,t,r){e.object&&r.add({kind:this.getSuggestionKind("object"),label:"{}",insertText:this.getInsertTextForGuessedValue({},t),insertTextFormat:l.InsertTextFormat.Snippet,detail:p("defaults.object","New object"),documentation:""}),e.array&&r.add({kind:this.getSuggestionKind("array"),label:"[]",insertText:this.getInsertTextForGuessedValue([],t),insertTextFormat:l.InsertTextFormat.Snippet,detail:p("defaults.array","New array"),documentation:""})},e.prototype.addBooleanValueCompletion=function(e,t,r){r.add({kind:this.getSuggestionKind("boolean"),label:e?"true":"false",insertText:this.getInsertTextForValue(e,t),insertTextFormat:l.InsertTextFormat.Snippet,documentation:""})},e.prototype.addNullValueCompletion=function(e,t){t.add({kind:this.getSuggestionKind("null"),label:"null",insertText:"null"+e,insertTextFormat:l.InsertTextFormat.Snippet,documentation:""})},e.prototype.addDollarSchemaCompletions=function(e,t){var r=this,n=this.schemaService.getRegisteredSchemaIds(function(e){return"http"===e||"https"===e});n.forEach(function(n){return t.add({kind:l.CompletionItemKind.Module,label:r.getLabelForValue(n),filterText:r.getFilterTextForValue(n),insertText:r.getInsertTextForValue(n,e),insertTextFormat:l.InsertTextFormat.Snippet,documentation:""})})},e.prototype.sanitizeLabel=function(e){return e=e.replace(/[\n]/g,"↵"),e.length>57&&(e=e.substr(0,57).trim()+"..."),e},e.prototype.getLabelForValue=function(e){return this.sanitizeLabel(JSON.stringify(e))},e.prototype.getFilterTextForValue=function(e){return JSON.stringify(e)},e.prototype.getFilterTextForSnippetValue=function(e){return JSON.stringify(e).replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1")},e.prototype.getLabelForSnippetValue=function(e){var t=JSON.stringify(e);return t=t.replace(/\$\{\d+:([^}]+)\}|\$\d+/g,"$1"),this.sanitizeLabel(t)},e.prototype.getInsertTextForPlainText=function(e){return e.replace(/[\\\$\}]/g,"\\$&")},e.prototype.getInsertTextForValue=function(e,t){var r=JSON.stringify(e,null,"	");return"{}"===r?"{$1}"+t:"[]"===r?"[$1]"+t:this.getInsertTextForPlainText(r+t)},e.prototype.getInsertTextForSnippetValue=function(e,t){var r=function(e){return"string"==typeof e&&"^"===e[0]?e.substr(1):JSON.stringify(e)};return i.stringifyObject(e,"",r)+t},e.prototype.getInsertTextForGuessedValue=function(e,t){switch(typeof e){case"object":return null===e?"${1:null}"+t:this.getInsertTextForValue(e,t);case"string":var r=JSON.stringify(e);return r=r.substr(1,r.length-2),r=this.getInsertTextForPlainText(r),'"${1:'+r+'}"'+t;case"number":case"boolean":return"${1:"+JSON.stringify(e)+"}"+t}return this.getInsertTextForValue(e,t)},e.prototype.getSuggestionKind=function(e){if(Array.isArray(e)){var t=e;e=t.length>0?t[0]:null}if(!e)return l.CompletionItemKind.Value;switch(e){case"string":return l.CompletionItemKind.Value;case"object":return l.CompletionItemKind.Module;case"property":return l.CompletionItemKind.Property;default:return l.CompletionItemKind.Value}},e.prototype.getLabelTextForMatchingNode=function(e,t){switch(e.type){case"array":return"[]";case"object":return"{}";default:var r=t.getText().substr(e.offset,e.length);return r}},e.prototype.getInsertTextForMatchingNode=function(e,t,r){switch(e.type){case"array":return this.getInsertTextForValue([],r);case"object":return this.getInsertTextForValue({},r);default:var n=t.getText().substr(e.offset,e.length)+r;return this.getInsertTextForPlainText(n)}},e.prototype.getInsertTextForProperty=function(e,t,r,n){var o=this.getInsertTextForValue(e,"");if(!r)return o;var i,a=o+": ",l=0;if(t){if(Array.isArray(t.defaultSnippets)){if(1===t.defaultSnippets.length){var u=t.defaultSnippets[0].body;s.isDefined(u)&&(i=this.getInsertTextForSnippetValue(u,""))}l+=t.defaultSnippets.length}if(t.enum&&(i||1!==t.enum.length||(i=this.getInsertTextForGuessedValue(t.enum[0],"")),l+=t.enum.length),s.isDefined(t.default)&&(i||(i=this.getInsertTextForGuessedValue(t.default,"")),l++),0===l){var p=Array.isArray(t.type)?t.type[0]:t.type;switch(p||(t.properties?p="object":t.items&&(p="array")),p){case"boolean":i="$1";break;case"string":i='"$1"';break;case"object":i="{$1}";break;case"array":i="[$1]";break;case"number":case"integer":i="${1:0}";break;case"null":i="${1:null}";break;default:return o}}}return(!i||l>1)&&(i="$1"),a+i+n},e.prototype.getCurrentWord=function(e,t){for(var r=t-1,n=e.getText();r>=0&&-1===' 	\n\r":{[,]}'.indexOf(n.charAt(r));)r--;return n.substring(r+1,t)},e.prototype.evaluateSeparatorAfter=function(e,t){var r=o.createScanner(e.getText(),!0);r.setPosition(t);var n=r.scan();switch(n){case 5:case 2:case 4:case 17:return"";default:return","}},e.prototype.findItemAtOffset=function(e,t,r){for(var n=o.createScanner(t.getText(),!0),i=e.items,a=i.length-1;a>=0;a--){var s=i[a];if(r>s.offset+s.length){n.setPosition(s.offset+s.length);var l=n.scan();return 5===l&&r>=n.getTokenOffset()+n.getTokenLength()?a+1:a}if(r>=s.offset)return a}return 0},e.prototype.isInComment=function(e,t,r){var n=o.createScanner(e.getText(),!1);n.setPosition(t);for(var i=n.scan();17!==i&&n.getTokenOffset()+n.getTokenLength()<r;)i=n.scan();return(12===i||13===i)&&n.getTokenOffset()<=r},e.prototype.fromMarkup=function(e){return e&&this.doesSupportMarkdown()?{kind:l.MarkupKind.Markdown,value:e}:void 0},e.prototype.doesSupportMarkdown=function(){if(!s.isDefined(this.supportsMarkdown)){var e=this.clientCapabilities.textDocument&&this.clientCapabilities.textDocument.completion;this.supportsMarkdown=e&&e.completionItem&&Array.isArray(e.completionItem.documentationFormat)&&-1!==e.completionItem.documentationFormat.indexOf(l.MarkupKind.Markdown)}return this.supportsMarkdown},e}();t.JSONCompletion=c});